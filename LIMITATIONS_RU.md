### Ограничения и важные особенности

Этот экспортер — гибкий инструмент, но у него есть свои правила и ограничения. Этот документ поможет понять, чего стоит и чего не стоит ожидать от программы.

#### I. Обработка значений

*   **Весь вывод команды читается в память.**
    Экспортер не обрабатывает данные потоково. Он сначала полностью выполняет команду, читает **весь её вывод** в оперативную память и только потом начинает его обрабатывать. Если ваша команда может вернуть очень большой объем текста (сотни мегабайт или гигабайты), это может привести к огромному потреблению памяти и падению экспортера. Старайтесь, чтобы ваши команды были "немногословными".

*   **Экспортер понимает только числа.**
    Он не умеет преобразовывать текстовые статусы вроде `"active"` или `"running"` в числовые значения (например, 1 или 0). Ваша команда должна сама возвращать готовое число.

*   **Пустой вывод от команды игнорируется.**
    Если ваша команда ничего не вывела в `stdout`, экспортер не создаст метрику и не запишет ошибку в лог. Он не может отличить команду, которая штатно вернула "ничего", от команды, которая "тихо" не сработала.

*   **Предполагается, что вывод в кодировке UTF-8.**
    Экспортер не умеет работать с бинарными данными или текстом в экзотических кодировках. Весь вывод от команд должен быть в формате UTF-8.

#### II. Выполнение команд

*   **Ошибка выполнения важнее результата.**
    Если команда завершилась с ненулевым кодом выхода (т.е. с ошибкой), экспортер проигнорирует все, что она вывела в `stdout`, даже если там было валидное число. Ошибка всегда имеет приоритет.

*   **Черный список не проверяет содержимое скриптов.**
    Проверка на опасные команды — поверхностная. Она смотрит только на *первое слово* в строке `command` в вашем конфиге. Например, если в конфиге написано `command: ./my_script.sh`, экспортер проверит, не заблокирована ли команда `./my_script.sh`, но он **не будет** заглядывать внутрь самого файла `my_script.sh`. Если в этом скрипте будет `rm -rf /`, экспортер этого не заметит и выполнит команду. Поэтому, если вы используете shell-скрипты, вся ответственность за их содержимое лежит на вас.

*   **Интерактивные команды "повесят" метрику.**
    Не используйте в конфиге команды, которые требуют интерактивного ввода (например, `read password`). Такая команда будет вечно ждать ввода, который никогда не поступит, и "зависнет", пока не отработает по таймауту.

*   **Флаг `ignore_blacklist` — это опасно.**
    Этот флаг полностью отключает проверку на опасные команды для конкретной метрики. Используйте его, только если на 100% уверены в том, что делаете.

#### III. Что экспортер не умеет (и почему)

*   **Соблюдать логику `counter`'ов.**
    Если вы указали тип метрики `counter`, экспортер не будет проверять, что ее значение только растет. Он просто передаст Prometheus то число, которое вернула ваша команда. Если значение уменьшится, Prometheus посчитает это сбросом счетчика, что может "сломать" ваши графики с `rate()`. Следить за этим — ваша задача.

*   **Поддерживать `Histogram` и `Summary`.**
    Поддерживаются только два основных типа метрик: `gauge` (измеритель) и `counter` (счетчик).

*   **Работать по HTTPS.**
    Экспортер отдает метрики только по обычному HTTP. Шифрование трафика (TLS) не поддерживается.

*   **Автоматически находить скрипты.**
    Все метрики должны быть явно описаны в одном конфигурационном файле. Экспортер не умеет автоматически подхватывать и запускать скрипты из какой-либо директории.