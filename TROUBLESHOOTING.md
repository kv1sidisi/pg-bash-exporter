### Руководство по устранению неполадок

#### 1. Экспортер не запускается

**Симптом:** При запуске экспортер завершает работу с ошибкой `configuration is invalid`.

**Решение:**
*   **Проверка конфигурации:** Запустите экспортер с флагом `--validate-config` для проверки синтаксиса `config.yaml`.
    ```sh
    ./pg-bash-exporter --config config.yaml --validate-config
    ```
*   **Проверка синтаксиса YAML:** Убедитесь в корректности отступов в файле `config.yaml`. Стандартный отступ — два пробела.

#### 2. Метрика не отображается на эндпоинте `/metrics`

**Симптом:** Метрика добавлена в конфигурацию, но отсутствует на странице `/metrics`.

**Решение:**
1.  **Анализ логов:** Установите `logging.level: "debug"` в `config.yaml` для получения подробной информации об ошибках.
2.  **Ручное выполнение команды:** Выполните команду из конфигурации в терминале для проверки ее вывода и кода завершения.
3.  **Проверка прав доступа:** Убедитесь, что пользователь, от имени которого запущен экспортер, имеет права на выполнение команды или доступ к необходимым файлам.
4.  **Анализ вывода команды:** Экспортер игнорирует пустой вывод или вывод, который не может быть преобразован в число. Информация об этом будет в логах.

#### 3. Prometheus не может получить метрики (ошибка `scrape timeout`)

**Симптом:** В интерфейсе Prometheus экспортер имеет статус "DOWN" с ошибкой `context deadline exceeded` или `scrape timeout`.

**Решение:**
*   **Причина:** Суммарное время выполнения команд превышает `scrape_timeout`, установленный в Prometheus.
*   **Оптимизация:** Оптимизируйте скрипты или увеличьте `timeout` для конкретной метрики в `config.yaml`. Убедитесь, что `timeout` меньше, чем `scrape_timeout` в Prometheus. Для ресурсоемких команд используйте кэширование (`cache_ttl`).

#### 4. Ошибка `duplicate metrics` в Prometheus

**Симптом:** Prometheus сообщает о дублировании метрик с одинаковыми именами и наборами меток.

**Решение:**
*   **Причина:** Команда возвращает несколько строк, что приводит к созданию нескольких метрик с идентичными именами и метками.
*   **Использование `dynamic_labels`:** Для многострочного вывода необходимо использовать `dynamic_labels` для создания уникальных меток для каждой строки.

#### 5. Команда выполняется в терминале, но не в экспортере

**Симптом:** Команда успешно выполняется в консоли, но в логах экспортера отображается ошибка.

**Решение:**
*   **Переменная `PATH`:** `PATH` системного сервиса может быть ограничен. Используйте абсолютные пути к исполняемым файлам в командах (например, `/usr/bin/grep`).
*   **Права доступа:** См. пункт 2.

#### 6. Изменения в конфигурации не применяются

**Симптом:** Файл `config.yaml` был изменен, но экспортер продолжает работать со старой конфигурацией.

**Решение:**
*   **Перезагрузка конфигурации:** Отправьте сигнал `SIGHUP` процессу экспортера для перезагрузки конфигурации. Определите PID процесса (`pgrep pg-bash-exporter`) и выполните `kill -HUP <pid>`.