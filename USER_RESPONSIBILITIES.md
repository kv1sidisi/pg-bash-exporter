### За что отвечаете вы

`pg-bash-exporter` — это мощный, но в первую очередь **исполнитель**. Он делает то, что вы ему говорите, и не пытается угадать ваши намерения.

Ниже перечислены вещи, за которые **полностью отвечаете вы**, как пользователь.

#### Категория I: Безопасность (самое важное)

*Ошибки здесь могут привести к взлому сервера или потере данных.*

1.  **Защищайте `config.yaml` как пароль от root.**
    Любой, кто может изменить этот файл, может выполнить на сервере любую команду от имени экспортера. **Никогда** не давайте права на запись в этот файл недоверенным пользователям.

2.  **Пишите команды, которые только читают данные.**
    Экспортер предназначен для мониторинга, а не для управления. Ваши команды не должны ничего создавать, изменять или удалять. Для этого есть другие инструменты.

3.  **Следите за "кардинальностью" меток.**
    Никогда не используйте в качестве значений для `labels` уникальные ID, email или временные метки. Это самый быстрый способ "убить" производительность вашего Prometheus. Метки нужны для небольшого числа категорий (например, `device="sda"`, `status="ok"`).

#### Категория II: Корректность данных

*Ошибки здесь приведут к тому, что вы будете видеть в Grafana неверные или бессмысленные графики.*

4.  **Соблюдайте типы метрик Prometheus.**
    Используйте `counter` **только** для значений, которые никогда не уменьшаются (например, количество обработанных запросов). Для всего остального (нагрузка CPU, количество процессов) используйте `gauge`.

5.  **Используйте `dynamic_labels` для многострочного вывода.**
    Если ваша команда возвращает несколько строк (например, статистику по каждому ядру CPU), вы **обязаны** использовать `dynamic_labels`, чтобы сделать каждую метрику уникальной. Иначе Prometheus выдаст ошибку.

6.  **Готовьте простой и стабильный вывод команд.**
    Чем проще вывод вашей команды (например, колонки, разделенные пробелами), тем надежнее будет работать парсинг. Используйте `awk`, `grep` и `sed`, чтобы "очистить" данные до того, как они попадут в экспортер.

#### Категория III: Стабильная работа

7.  **Настраивайте таймауты правильно.**
    Общий таймаут на выполнение команды в `config.yaml` должен быть **меньше**, чем `scrape_timeout` в настройках Prometheus. Иначе Prometheus будет отключаться от экспортера, не дождавшись ответа.

8.  **Проверяйте конфиг перед применением.**
    Всегда используйте флаг `--validate-config` для проверки синтаксиса `config.yaml` перед тем, как перезагружать конфигурацию на работающем сервере.

9.  **Следите за производительностью команд.**
    Перед тем как добавить команду в конфиг, проверьте, как быстро она выполняется (`time ваша_команда`). Слишком "тяжелые" команды могут замедлить не только сбор метрик, но и работу всего сервера. Используйте кэш (`cache_ttl`) для таких команд.